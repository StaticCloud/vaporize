<style>
.game-selection-wrapper {
    margin: 0 auto;
    max-width: 1050px;
}

.game-selection-header {
    margin: 2rem 0;
}

.game-selection {
    display: flex;
    flex: 0 1;
    gap: 4px;
    flex-wrap: wrap;
}

.game-banner {
    width: 18%;
    aspect-ratio: 2 / 3;
    background-position: center;
    background-size: cover;
    border: 3px solid var(--primary);
}

.game-banner input[type="checkbox"] {
    width: 100%;
    height: 100%;
    opacity: 0;
}

.game-banner:has(input[type="checkbox"]:disabled) {
    opacity: 0.5;
}

.game-banner:has(> input[type="checkbox"]:checked) {
    border: 3px solid var(--secondary);
}

.game-selection-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 2rem;
}

#submit-banners {
    padding: .5rem 1rem;
    background-color: var(--secondary);
    color: var(--plain-text);
}

#submit-banners:disabled {
    opacity: 0.5;
}
</style>
<div class="game-selection-wrapper">
    <div class="game-selection-header">
        <h1>Select Four Game Banners</h1>
        <p>Banners will appear on the design in the order they're selected.</p>
    </div>
    <div class="game-selection">
        {% for game in games %}
            <div class="game-banner" data-banner="{{ game }}" style="background-image: url('{{ game }}'), none;">
                <input type="checkbox" value="{{ game }}">
            </div>
        {% endfor %} 
    </div>
    <div class="game-selection-footer">
        <p id="total">0 / 4</p>
        <button id="submit-banners" hx-target=".game-selection-wrapper" hx-swap="outerHTML" hx-post="/templates/design/" hx-ext="json-enc" hx-vals='js:{ "body":getBanners() }' disabled="true">Next</button>
    </div>
</div>
<script>

    document.querySelectorAll(".game-banner").forEach((banner) => {
        fetch(banner.getAttribute("data-banner"), { method: "HEAD" }).then((res) => {
            if (res.status === 404) {
                banner.style.display = "none";
            }
        })
    })

    const limit = 4;
    const checkboxes = document.querySelectorAll('.game-banner input[type="checkbox"]')
    const total = document.querySelector("#total");
    const submit = document.querySelector("#submit-banners");

    let banners = [];

    const getBanners = () => JSON.stringify({ 'banners': banners });

    checkboxes.forEach((checkbox) => {
        checkbox.addEventListener("change", () => {
            const url = checkbox.getAttribute("value"); 

            if (banners.includes(url)) {
                banners = banners.filter(banner => banner !== url)
            } else {
                banners.push(url)
            }

            const count = document.querySelectorAll('.game-banner input[type="checkbox"]:checked').length;

            total.textContent = `${count} / 4`

            if (count >= limit) {
                checkboxes.forEach(cb => {
                    if (!cb.checked) cb.disabled = true;
                })

                submit.disabled = false;
            } else {
                checkboxes.forEach(cb => cb.disabled = false);

                submit.disabled = true;
            }
        })
    })
</script>